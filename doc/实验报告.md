# Rotten Beans

Rotten tomatoesğŸ… + DouBan BeansğŸ«˜


## Quickstart

### **Dependencies**
- rustup 1.28.1 (f9edccde0 2025-03-05)
  - `cd backend && cargo build`
- Postgresql && diesel_cli
  - Follow the [official guide of diesel](https://diesel.rs/guides/getting-started.html) to set up postgresql for the project.
- node v22.14.0
  - `cd frontend && npm install`

### Get startâœ¨
`make dev`

Open `http://localhost:5173`

---

## é¡¹ç›®ç»“æ„

```
RottenBeans/
â”œâ”€â”€ README.md
â”œâ”€â”€ backend/                # åç«¯ Rust + Diesel + Actix å®ç°
â”‚   â”œâ”€â”€ migrations/         # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ src/                # åç«¯æºä»£ç ï¼ˆåŒ…æ‹¬ authã€dbã€handlers ç­‰æ¨¡å—ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.rs
â”‚   â”‚   â”œâ”€â”€ bin/            # å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ db/             # æ•°æ®æ“ä½œä»£ç 
â”‚   â”‚   â”œâ”€â”€ handlers/       # actix_webå¤„ç†è¯·æ±‚çš„handlers  
â”‚   â”‚   â”œâ”€â”€ lib.rs
â”‚   â”‚   â”œâ”€â”€ main.rs
â”‚   â”‚   â”œâ”€â”€ models/         
â”‚   â”‚   â””â”€â”€ schema.rs
â”‚   â””â”€â”€ diesel.toml
â”œâ”€â”€ book_scraper/           # å›¾ä¹¦çˆ¬è™«æ¨¡å—ï¼Œä½¿ç”¨ Python ç¼–å†™
â”‚   â”œâ”€â”€ book_scraper/
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ frontend/               # å‰ç«¯ React + TypeScript å®ç°
â”‚   â”œâ”€â”€ public/
â”‚   â””â”€â”€ src/                # å‰ç«¯æºä»£ç ï¼ˆç»„ä»¶ã€é¡µé¢ã€æ¥å£ç­‰ï¼‰
â””â”€â”€ makefile                # å¿«æ·æ„å»ºå‘½ä»¤
```

---

## æ•°æ®è¡¨çš„è®¾è®¡

### 1. users è¡¨ï¼šç”¨æˆ·ä¿¡æ¯ç®¡ç†

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(64) UNIQUE NOT NULL,
    password VARCHAR(128) NOT NULL, -- MD5
    real_name VARCHAR(64) NOT NULL,
    employee_id INTEGER NOT NULL,
    gender VARCHAR(8) NOT NULL, -- "male" or "female"
    age INTEGER NOT NULL,
    is_super BOOLEAN NOT NULL DEFAULT FALSE
);
```
- è®¾è®¡ç›®çš„ï¼š

  - ç®¡ç†ç³»ç»Ÿç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼ŒåŒºåˆ†æ™®é€šå‘˜å·¥ä¸ç®¡ç†å‘˜ã€‚

- å­—æ®µè¯´æ˜ï¼š

  - id: è‡ªå¢ä¸»é”®ï¼Œå”¯ä¸€æ ‡è¯†ç”¨æˆ·ã€‚

  - username: ç™»å½•è´¦å·ï¼Œå”¯ä¸€çº¦æŸã€‚

  - password: åŠ å¯†åçš„å¯†ç ï¼ˆMD5ï¼‰ã€‚

  - real_name: çœŸå®å§“åï¼Œç”¨äºå±•ç¤ºå’Œäººäº‹ç®¡ç†ã€‚

  - employee_id: å‘˜å·¥ç¼–å·ï¼Œç”¨äºå…³è”å®é™…å·¥å·ã€‚

  - gender / age: åŸºæœ¬ä¿¡æ¯ç»Ÿè®¡ã€‚

  - is_super: æ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼Œç”¨äºæƒé™æ§åˆ¶ã€‚

### 2. books è¡¨ï¼šå›¾ä¹¦ä¿¡æ¯ç®¡ç†

```sql
CREATE TABLE books (
    id UUID PRIMARY KEY,
    isbn TEXT NOT NULL,
    title TEXT NOT NULL,
    author TEXT NOT NULL,
    publisher TEXT NOT NULL,
    retail_price NUMERIC NOT NULL,
    stock INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

```
- è®¾è®¡ç›®çš„ï¼š

  - å­˜å‚¨ä¹¦ç±çš„åŸºæœ¬ä¿¡æ¯å’Œåº“å­˜æƒ…å†µã€‚

- å­—æ®µè¯´æ˜ï¼š
  - id: ä¸»é”®ï¼Œä½¿ç”¨ UUID ä»¥ä¾¿äºå¤–éƒ¨ç³»ç»Ÿå¯¹æ¥ã€‚
  - isbn: å›½é™…æ ‡å‡†ä¹¦å·ã€‚
  - title, author, publisher: åŸºç¡€ä¹¦ç±ä¿¡æ¯ã€‚
  - retail_price: å”®ä»·ï¼Œç”¨äºå‰å°å±•ç¤ºä¸è´¢åŠ¡æ ¸ç®—ã€‚
  - stock: å½“å‰åº“å­˜æ•°é‡ï¼Œä¾¿äºç®¡ç†å…¥åº“å‡ºåº“ã€‚
  - created_at: åˆ›å»ºæ—¶é—´ï¼Œç”¨äºè¿½è¸ªè®°å½•ã€‚


### 3. purchases è¡¨ï¼šé‡‡è´­è®°å½•ç®¡ç†

```sql
CREATE TABLE purchases (
    id UUID PRIMARY KEY,
    book_id UUID REFERENCES books(id) NOT NULL,
    quantity INTEGER NOT NULL,
    purchase_price NUMERIC NOT NULL,
    status TEXT NOT NULL, -- unpaid, paid, returned
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

```
- è®¾è®¡ç›®çš„ï¼š
  - è·Ÿè¸ªä¹¦ç±é‡‡è´­æµç¨‹ï¼ŒåŒ…æ‹¬é‡‡è´­æ•°é‡ã€å•ä»·åŠçŠ¶æ€ã€‚
- å­—æ®µè¯´æ˜ï¼š
  - book_id: å¤–é”®å…³è” books è¡¨ï¼Œæ ‡è¯†é‡‡è´­çš„ä¹¦ç±ã€‚
  - quantity: é‡‡è´­æ•°é‡ã€‚
  - purchase_price: å•æœ¬é‡‡è´­ä»·æ ¼ã€‚
  - status: å½“å‰çŠ¶æ€ï¼ˆæœªæ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²é€€è´§ï¼‰ï¼Œä¾¿äºæµç¨‹ç®¡ç†ã€‚
  - created_at: è®°å½•é‡‡è´­æ—¶é—´ã€‚

### 4. finance_logs è¡¨ï¼šè´¢åŠ¡è®°å½•

```sql

CREATE TABLE finance_logs (
    id UUID PRIMARY KEY,
    action_type TEXT NOT NULL, -- income, expense
    amount NUMERIC NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
);

```
- è®¾è®¡ç›®çš„ï¼š
  - è®°å½•æ¯ç¬”ä¸å›¾ä¹¦ç›¸å…³çš„è´¢åŠ¡æ”¶æ”¯å˜åŠ¨ã€‚
- å­—æ®µè¯´æ˜ï¼š
  - action_type: æ”¶å…¥æˆ–æ”¯å‡ºã€‚
  - amount: é‡‘é¢ã€‚
  - created_at: æ—¥å¿—æ—¶é—´æˆ³ï¼Œç”¨äºè¿½è¸ªè´¢åŠ¡æµã€‚


---

## åŠŸèƒ½å®ç°

### 1. ç”¨æˆ·ç®¡ç†æ¨¡å—
- ç™»é™†ä¸é‰´æƒï¼šä½¿ç”¨ JWT å®ç° token ç™»é™†ã€é‰´æƒé€»è¾‘ï¼Œæ‰€æœ‰å—ä¿æŠ¤è·¯ç”±é€šè¿‡ RequireAuth ç»„ä»¶æ‹¦æˆªã€‚

- Tokenè¿‡æœŸå¤„ç†ï¼šè®¾ç½® token æœ‰æ•ˆæ—¶é—´ä¸º1å°æ—¶ï¼Œè¶…æ—¶è‡ªåŠ¨ç™»å‡ºã€‚`/RottenBeans/backend/src/auth.rs`

```rust
    let exp = Utc::now()
        .checked_add_signed(Duration::hours(1))
        .unwrap()
        .timestamp() as usize;
```

- è¶…çº§ç®¡ç†å‘˜æœºåˆ¶ï¼šåˆå§‹åŒ–ç³»ç»Ÿæ—¶åˆ›å»ºè¶…çº§ç®¡ç†å‘˜ï¼›è¶…çº§ç®¡ç†å‘˜å¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬åˆ›å»ºæ–°ç”¨æˆ·ã€æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ã€‚è€Œæ™®é€šç”¨æˆ·åªèƒ½ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ã€‚

```rust
pub struct AuthUser {
    pub username: String,
    pub is_super: bool,
}

impl FromRequest for AuthUser
```
`AuthUser`å®ç°äº†`FromRequest` trait, åç«¯æ¥å—å‰ç«¯è¯·æ±‚æ—¶å¯ä»¥é€šè¿‡æ£€éªŒtoken, åˆ†æ`is_super`æ¥ç¡®å®šæ˜¯å¦æ—¶è¶…çº§ç®¡ç†å‘˜.

![admin people](image.png)
![ordinary people](image-1.png)

- å¯†ç å‚¨å­˜ï¼šä½¿ç”¨md5åŠ å¯†å‚¨å­˜ã€‚

### 2. å›¾ä¹¦ç®¡ç†æ¨¡å—
- å›¾ä¹¦æŸ¥è¯¢ï¼šæ”¯æŒæŒ‰ç…§ ISBNã€ä¹¦åã€ä½œè€…ã€å‡ºç‰ˆç¤¾ç­‰å­—æ®µæ¨¡ç³ŠåŒ¹é…ã€‚

- å›¾ä¹¦ä¿¡æ¯ä¿®æ”¹ï¼šç®¡ç†å‘˜å¯å¯¹ä¹¦ç±çš„åç§°ã€ä½œè€…ã€å‡ºç‰ˆç¤¾ã€ä»·æ ¼ç­‰ä¿¡æ¯è¿›è¡Œç¼–è¾‘ã€‚

![alt text](image-2.png)

### 3. å›¾ä¹¦é”€å”®æ¨¡å—

- è¿›è´§ï¼šç³»ç»Ÿä¼šæ£€æµ‹å›¾ä¹¦æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°åº“å­˜ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºã€‚

- ä»˜æ¬¾/å–å‡º/é€€è´§ï¼šæ ¹æ®è®¢å•æ“ä½œï¼Œè‡ªåŠ¨è°ƒæ•´åº“å­˜æ•°é‡ï¼Œé¿å…è´Ÿåº“å­˜ç°è±¡ã€‚

![alt text](image-3.png)

### 4. è´¢åŠ¡æ¨¡å—

- æ”¶å…¥ä¸æ”¯å‡ºè®°å½•ï¼šè‡ªåŠ¨è®°å½•æ¯ä¸€æ¬¡ä»˜æ¬¾ä¸å”®å‡ºçš„æ”¶æ”¯é‡‘é¢ã€‚

- æ—¶é—´ç­›é€‰ï¼šå¯æŒ‰æ—¶é—´æ®µæŸ¥çœ‹æŒ‡å®šåŒºé—´çš„è´¢åŠ¡æ•°æ®ã€‚

- æ•°æ®å¯è§†åŒ–ï¼šç»˜åˆ¶å›¾è¡¨ï¼Œæ›´å½¢è±¡ç›´è§‚å±•ç°ä¹¦åŸè´¢åŠ¡æ•°æ®ã€‚

![alt text](image-4.png)

### 5. çˆ¬è™«æ¨¡å—ï¼ˆbook_scraperï¼‰

- è±†ç“£å›¾ä¹¦ä¿¡æ¯è·å–ï¼šä½¿ç”¨ Python è„šæœ¬æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®è±†ç“£ç½‘é¡µï¼Œè·å–ä¹¦ç±ä¿¡æ¯ï¼›æ•°æ®ç»“æœä¿å­˜ä¸º JSON æ–‡ä»¶ä¾›åç«¯å¯¼å…¥ã€‚`book_scraper/book_scraper/douban_book.json`


---

### å…·ä½“åŠŸèƒ½

#### ç”¨æˆ·ç®¡ç†

- [x] ç™»é™†
- [x] ç™»é™†åæ‰èƒ½æ“ä½œ tokenä¼ é€’ **RequireAuth component**
- [x] token **unauthorization** time expiaration (1 hour) + sign out
- [x] è¶…çº§ç®¡ç†å‘˜
  - [x] åˆå§‹åˆ›å»º
  - [x] åˆ›å»ºç”¨æˆ·
  - [x] æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·èµ„æ–™

#### å›¾ä¹¦ç®¡ç†

- [x] æŸ¥è¯¢å›¾ä¹¦
  - [x] ä¹¦ç±ç¼–å·ã€ä¹¦ç±ISBNå·ã€ä¹¦åã€ä½œè€…ã€å‡ºç‰ˆç¤¾ ç­‰
  - [x] æ¨¡ç³ŠæŸ¥è¯¢
- [x] å›¾ä¹¦ä¿¡æ¯ä¿®æ”¹ ä¹¦ç±åç§°ã€ä½œè€…ã€å‡ºç‰ˆç¤¾ã€é›¶å”®ä»·æ ¼

#### å›¾ä¹¦é”€å”®

- [x] è¿›è´§
  - [x] æŸ¥è¯¢æ˜¯å¦å­˜åœ¨
- [x] ä»˜æ¬¾
  - [x] æ›´æ–°åº“å­˜
- [x] é€€è´§
- [x] å–å‡º
  - [x] æ›´æ–°åº“å­˜

#### è´¢åŠ¡ä¿¡æ¯

- [x] ä»˜æ¬¾ã€å”®å‡ºï¼Œ æ›´æ–°æ”¯å‡º/æ”¶å…¥
- [x] æŸ¥çœ‹æŸæ®µæ—¶é—´çš„è®°å½•
- [x] ç»˜å›¾

#### ä¹¦ç±æ•°æ®

- [x] çˆ¬è™«ï¼Œæ·»åŠ æ•°æ®

---

## æŠ€æœ¯æ ˆ

| æ¨¡å—   | æŠ€æœ¯æ ˆ                                      |
| ---- | ---------------------------------------- |
| å‰ç«¯   | React, TypeScript, Vite, Axios, Recharts, Bootstrap |
| åç«¯   | Rust, Actix-web, Diesel ORM, PostgreSQL  |
| æ•°æ®çˆ¬å– | Python, Requests, BeautifulSoup          |
| é‰´æƒæœºåˆ¶ | JWT (Json Web Token)                     |
| æ„å»ºå·¥å…· | Makefile                                 |
| ä»£ç é£æ ¼ | Prettier                         |

